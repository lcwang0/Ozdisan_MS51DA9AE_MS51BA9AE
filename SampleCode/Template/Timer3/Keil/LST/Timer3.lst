C51 COMPILER V9.60.0.0   TIMER3                                                            03/11/2021 10:56:29 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TIMER3
OBJECT MODULE PLACED IN .\Output\Timer3.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Timer3.c OPTIMIZE(7,SPEED) BROWSE INCDIR(..\..\..\..\Library\Device\I
                    -nclude;..\..\..\..\Library\StdDriver\inc) DEBUG OBJECTEXTEND PRINT(.\LST\Timer3.lst) TABS(2) OBJECT(.\Output\Timer3.obj)

line level    source

   1          /*--------------------------------------------------------------------------------------------------------
             --*/
   2          /*                                                                                                        
             - */
   3          /* Copyright(c) 2020 nuvoton Technology Corp. All rights reserved.                                        
             - */
   4          /*                                                                                                        
             - */
   5          /*--------------------------------------------------------------------------------------------------------
             --*/
   6          
   7          /*********************************************************************************************************
             -**/
   8          /* Website: http://www.nuvoton.com                                                                        
             - */
   9          /*  E-Mail : MicroC-8bit@nuvoton.com                                                                      
             - */
  10          /*  Date   : June/21/2020                                                                                 
             -  */
  11          /*********************************************************************************************************
             -**/
  12          
  13          /*********************************************************************************************************
             -***/
  14          /*  File Function: MS51 Timer 3 with interrupt demo                                                       
             -  */
  15          /*********************************************************************************************************
             -***/
  16          #include "MS51_8K.H"
  17          
  18          #define DIV1      1
  19          #define DIV2      2
  20          #define DIV4      4
  21          #define DIV8      8
  22          #define DIV16     16
  23          #define DIV32     32
  24          #define DIV64     64
  25          #define DIV128    128
  26          
  27          
  28          #define SyncPin   P01        //P0.1
  29          bit SyncToggle;
  30          #define RamDataLen 10
  31          typedef union
  32          {
  33               unsigned char ByteArray[RamDataLen];
  34               struct
  35               {                                                                                            
  36                    unsigned char MainsToggle;       
  37                    unsigned char MainsBufferCnt;   
  38                    unsigned char MainsCnt;          
  39               }Data;
  40          }RAM_t;
  41          
C51 COMPILER V9.60.0.0   TIMER3                                                            03/11/2021 10:56:29 PAGE 2   

  42          RAM_t xdata RAM;
  43          
  44                          
  45          /*********************************************************************************************************
             -***
  46          *    TIMER 3 interrupt subroutine
  47          **********************************************************************************************************
             -**/
  48          void Timer3_ISR (void) interrupt 16 
  49          {
  50   1          _push_(SFRS);
  51   1          
  52   1          clr_T3CON_TF3;
  53   1          P17 = ~P17;
  54   1                        RAM.Data.MainsBufferCnt++;
  55   1                      RAM.Data.MainsCnt++;           
  56   1      
  57   1          if(SyncPin==SyncToggle)
  58   1          //if(SyncToggle==P01)
  59   1          {
  60   2            SyncToggle ^= 1;
  61   2          }
  62   1      
  63   1          _pop_(SFRS);
  64   1      }
  65          
  66          /*********************************************************************************************************
             -***
  67          *    TIMER 3 interrupt Initial setting
  68          **********************************************************************************************************
             -**/
  69          void Timer3_INT_Initial(unsigned char u8TMDIV, 
  70                                  unsigned char u8RH3, 
  71                                  unsigned char u8RL3)
  72          {
  73   1          SFRS = 0x00;
  74   1          switch (u8TMDIV)
  75   1          {
  76   2            case DIV1:T3CON&=0xF8; break;
  77   2            case DIV2:T3CON&=0xF8;T3CON|=0x01; break;
  78   2            case DIV4:T3CON&=0xF8;T3CON|=0x02; break;
  79   2            case DIV8:T3CON&=0xF8;T3CON|=0x03; break;
  80   2            case DIV16:T3CON&=0xF8;T3CON|=0x04; break;
  81   2            case DIV32:T3CON&=0xF8;T3CON|=0x05; break;
  82   2            case DIV64:T3CON&=0xF8;T3CON|=0x06; break;
  83   2            case DIV128:T3CON&=0xF8;T3CON|=0x07; break;
  84   2          }
  85   1            clr_T3CON_TF3;
  86   1            RH3 = u8RH3;
  87   1            RL3 = u8RL3;
  88   1            set_EIE1_ET3;                              //enable Timer3 interrupt
  89   1      }
  90          
  91           /********************************************************************************************************
             -****
  92          *    Main function 
  93          **********************************************************************************************************
             -**/
  94          void main (void)
  95          {
  96   1          SyncToggle = 0;
  97   1          
C51 COMPILER V9.60.0.0   TIMER3                                                            03/11/2021 10:56:29 PAGE 3   

  98   1          P17_QUASI_MODE;
  99   1          P01_QUASI_MODE;
 100   1        
 101   1          Timer3_INT_Initial(DIV16,0x20,0x00);
 102   1          ENABLE_GLOBAL_INTERRUPT;                                  //enable global interrupts
 103   1          set_T3CON_TR3;                              //Timer3 run
 104   1      
 105   1          while(1);
 106   1      }
 107          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    285    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     10    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
